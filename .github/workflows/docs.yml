name: Documentation

on:
  push:
    branches: [main]
    paths:
      - "**.md"
      - "docs/**"
      - ".github/workflows/docs.yml"
  pull_request:
    branches: [main]
    paths:
      - "**.md"
      - "docs/**"
      - ".github/workflows/docs.yml"

jobs:
  docs-check:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        task: [lint, spell, structure]
    name: Docs Check - ${{ matrix.task }}
    steps:
      - uses: actions/checkout@v4

      - name: Run ${{ matrix.task }} check
        run: |
          case "${{ matrix.task }}" in
            lint)
              npx markdownlint-cli2 "**/*.md" "!CHANGELOG.md" --config .markdownlint.json
              npx markdown-link-check -q -v -c .github/markdown-link-check.config.json README.md
              ;;
            spell)
              npx cspell "**/*.md" --config .github/cspell.config.yaml
              ;;
            structure)
              missing=0

              files=(
                "README.md"
                "CONTRIBUTING.md"
                "LICENSE"
                "SECURITY.md"
                "CODE_OF_CONDUCT.md"
                "CHANGELOG.md"
                "FAQ.md"
                "ROADMAP.md"
                "KNOWN_ISSUES.md"
              )

              for file in "${files[@]}"; do
                if [ ! -f "$file" ]; then
                  echo "Missing required file: $file"
                  missing=1
                else
                  echo "Found: $file"
                fi
              done

              templates=(
                ".github/ISSUE_TEMPLATE/bug_report.md"
                ".github/ISSUE_TEMPLATE/feature_request.md"
                ".github/pull_request_template.md"
              )

              for template in "${templates[@]}"; do
                if [ ! -f "$template" ]; then
                  echo "Missing template: $template"
                  missing=1
                else
                  echo "Found: $template"
                fi
              done

              if [ "$missing" -eq 1 ]; then
                exit 1
              fi

              echo "All required documentation files present"
              ;;
          esac